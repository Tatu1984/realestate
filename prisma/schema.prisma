generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User types: INDIVIDUAL, AGENT, BUILDER, ADMIN
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  phone         String?
  avatar        String?
  userType      String    @default("INDIVIDUAL") // INDIVIDUAL, AGENT, BUILDER, ADMIN
  isVerified    Boolean   @default(false)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  properties    Property[]
  favorites     Favorite[]
  inquiriesSent Inquiry[]  @relation("InquirySender")
  inquiriesReceived Inquiry[] @relation("InquiryReceiver")
  membership    Membership?
  agentProfile  AgentProfile?
  builderProfile BuilderProfile?
  requirements  Requirement[]
  newsletters   NewsletterSubscription[]
}

model AgentProfile {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyName   String?
  licenseNumber String?
  experience    Int?     // years of experience
  specialization String?
  description   String?
  address       String?
  city          String?
  state         String?
  isFeatured    Boolean  @default(false)
  rating        Float    @default(0)
  totalDeals    Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model BuilderProfile {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyName   String
  establishedYear Int?
  totalProjects Int      @default(0)
  ongoingProjects Int    @default(0)
  description   String?
  website       String?
  address       String?
  city          String?
  state         String?
  isFeatured    Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  projects      Project[]
}

model Project {
  id            String   @id @default(cuid())
  builderId     String
  builder       BuilderProfile @relation(fields: [builderId], references: [id], onDelete: Cascade)
  name          String
  description   String?
  status        String   @default("ONGOING") // ONGOING, COMPLETED, UPCOMING
  location      String
  city          String
  state         String
  startDate     DateTime?
  completionDate DateTime?
  totalUnits    Int?
  availableUnits Int?
  priceRange    String?
  amenities     String?  // JSON string of amenities
  images        String?  // JSON string of image URLs
  isFeatured    Boolean  @default(false)
  isPopular     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  properties    Property[]
}

model Property {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  projectId     String?
  project       Project? @relation(fields: [projectId], references: [id])

  title         String
  description   String?
  propertyType  String   // APARTMENT, HOUSE, VILLA, PLOT, COMMERCIAL, PG, ROOMMATE
  listingType   String   // SELL, RENT, PG, ROOMMATE

  // Location
  address       String
  locality      String
  city          String
  state         String
  pincode       String?
  latitude      Float?
  longitude     Float?

  // Property Details
  bedrooms      Int?
  bathrooms     Int?
  balconies     Int?
  floorNumber   Int?
  totalFloors   Int?
  facing        String?
  furnishing    String?  // FURNISHED, SEMI_FURNISHED, UNFURNISHED

  // Area
  builtUpArea   Float?
  carpetArea    Float?
  plotArea      Float?

  // Price
  price         Float
  pricePerSqft  Float?
  maintenance   Float?
  securityDeposit Float?

  // Media
  images        String?  // JSON string of image URLs
  videoUrl      String?

  // Amenities (JSON string)
  amenities     String?

  // Listing status
  status        String   @default("PENDING") // PENDING, ACTIVE, SOLD, EXPIRED
  listingTier   String   @default("BASIC") // BASIC, FEATURED, PREMIUM

  // Stats
  views         Int      @default(0)

  // Dates
  availableFrom DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  favorites     Favorite[]
  inquiries     Inquiry[]
  propertyViews PropertyView[]
  engagements   Engagement[]
  propertyInquiries PropertyInquiry[]
}

model Favorite {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@unique([userId, propertyId])
}

model Inquiry {
  id          String   @id @default(cuid())
  senderId    String
  sender      User     @relation("InquirySender", fields: [senderId], references: [id], onDelete: Cascade)
  receiverId  String
  receiver    User     @relation("InquiryReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  propertyId  String?
  property    Property? @relation(fields: [propertyId], references: [id], onDelete: SetNull)

  name        String
  email       String
  phone       String?
  message     String
  status      String   @default("PENDING") // PENDING, RESPONDED, CLOSED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Requirement {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  requirementType String // BUY, RENT
  propertyType  String
  minBudget     Float?
  maxBudget     Float?
  minArea       Float?
  maxArea       Float?
  bedrooms      String?  // Can be "1", "2", "3", "4+"
  preferredLocations String? // JSON string of locations
  description   String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Membership {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  planId        String
  plan          MembershipPlan @relation(fields: [planId], references: [id])
  startDate     DateTime @default(now())
  endDate       DateTime
  status        String   @default("ACTIVE") // ACTIVE, EXPIRED, CANCELLED
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model MembershipPlan {
  id              String   @id @default(cuid())
  name            String
  description     String?
  price           Float
  duration        Int      // in days
  featuredListings Int     @default(0)
  premiumListings Int      @default(0)
  basicListings   Int      @default(0)
  features        String?  // JSON string of features
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  memberships     Membership[]
}

model Banner {
  id          String   @id @default(cuid())
  title       String
  image       String
  link        String?
  position    String   // HOT_ZONE, PRIME_ZONE, FEATURED_ZONE, HOME_BANNER
  isActive    Boolean  @default(true)
  startDate   DateTime?
  endDate     DateTime?
  clicks      Int      @default(0)
  views       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model NewsletterSubscription {
  id        String   @id @default(cuid())
  email     String   @unique
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
}

model News {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String
  excerpt     String?
  image       String?
  isPublished Boolean  @default(false)
  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FAQ {
  id        String   @id @default(cuid())
  question  String
  answer    String
  category  String?
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String?
  message   String
  status    String   @default("NEW") // NEW, READ, REPLIED
  createdAt DateTime @default(now())
}

model SiteSettings {
  id          String @id @default(cuid())
  key         String @unique
  value       String
  description String?
}

model City {
  id        String   @id @default(cuid())
  name      String
  state     String
  isPopular Boolean  @default(false)
  image     String?
  createdAt DateTime @default(now())

  localities Locality[]
}

model Locality {
  id        String   @id @default(cuid())
  name      String
  cityId    String
  city      City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
  pincode   String?
  createdAt DateTime @default(now())
}

model Loan {
  id          String   @id @default(cuid())
  bankName    String
  bankLogo    String?
  interestRate Float
  maxAmount   Float?
  minAmount   Float?
  tenure      String?  // e.g., "10-30 years"
  processingFee String?
  features    String?  // JSON string
  link        String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  icon        String?
  image       String?
  parentId    String?
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Testimonial {
  id          String   @id @default(cuid())
  name        String
  designation String?
  company     String?
  content     String
  rating      Int      @default(5)
  image       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Event {
  id          String   @id @default(cuid())
  title       String
  description String?
  location    String?
  startDate   DateTime
  endDate     DateTime?
  image       String?
  link        String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Country {
  id          String   @id @default(cuid())
  name        String   @unique
  code        String   @unique
  phoneCode   String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model Currency {
  id          String   @id @default(cuid())
  name        String
  code        String   @unique
  symbol      String
  isDefault   Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model BankDetail {
  id            String   @id @default(cuid())
  accountName   String
  accountNumber String
  bankName      String
  branchName    String?
  ifscCode      String?
  swiftCode     String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Advertisement {
  id          String   @id @default(cuid())
  title       String
  image       String?
  link        String?
  position    String   // SIDEBAR, HEADER, FOOTER, INLINE
  startDate   DateTime?
  endDate     DateTime?
  clicks      Int      @default(0)
  views       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Amenity {
  id          String   @id @default(cuid())
  name        String   @unique
  icon        String?
  category    String?  // BASIC, SOCIETY, ADDITIONAL
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model Transaction {
  id            String   @id @default(cuid())
  userId        String
  type          String   // MEMBERSHIP, LISTING_UPGRADE, FEATURED
  amount        Float
  currency      String   @default("INR")
  status        String   @default("PENDING") // PENDING, COMPLETED, FAILED, REFUNDED
  paymentMethod String?
  transactionId String?
  description   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model DefaultImage {
  id          String   @id @default(cuid())
  name        String
  type        String   // PROPERTY, AVATAR, BANNER, LOGO
  url         String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model Reminder {
  id          String   @id @default(cuid())
  title       String
  description String?
  dueDate     DateTime
  priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH
  status      String   @default("PENDING") // PENDING, COMPLETED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Alert {
  id          String   @id @default(cuid())
  title       String
  message     String
  type        String   @default("INFO") // INFO, WARNING, ERROR, SUCCESS
  placement   String   @default("TOP_BANNER") // TOP_BANNER, POPUP, SIDEBAR, FOOTER
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model GoogleAdsSetting {
  id              String   @id @default(cuid())
  publisherId     String?
  headerAdCode    String?
  sidebarAdCode   String?
  footerAdCode    String?
  inArticleAdCode String?
  isEnabled       Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Page {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String
  metaTitle   String?
  metaDescription String?
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model UserRequest {
  id          String   @id @default(cuid())
  name        String
  email       String
  phone       String?
  userType    String   // INDIVIDUAL, AGENT, BUILDER
  message     String?
  documents   String?  // JSON string of document URLs
  status      String   @default("PENDING") // PENDING, APPROVED, REJECTED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model MembershipRequest {
  id          String   @id @default(cuid())
  userId      String
  planId      String
  currentPlan String?
  requestedPlan String
  reason      String?
  status      String   @default("PENDING") // PENDING, APPROVED, REJECTED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PropertyResponse {
  id              String   @id @default(cuid())
  propertyId      String
  propertyTitle   String
  propertyLocation String?
  userName        String
  userEmail       String
  userPhone       String?
  message         String
  status          String   @default("NEW") // NEW, CONTACTED, SITE_VISIT, CONVERTED, CLOSED
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model ProjectResponse {
  id          String   @id @default(cuid())
  projectId   String
  projectName String
  userName    String
  userEmail   String
  userPhone   String?
  message     String
  status      String   @default("NEW") // NEW, CONTACTED, CONVERTED, CLOSED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Analytics and Notifications Models

model PropertyView {
  id          String   @id @default(cuid())
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  userId      String?
  sessionId   String?
  referrer    String?
  userAgent   String?
  ipAddress   String?
  createdAt   DateTime @default(now())

  @@index([propertyId])
  @@index([userId])
  @@index([createdAt])
}

model SearchAnalytics {
  id          String   @id @default(cuid())
  query       String
  filters     String?  // JSON string
  resultCount Int
  userId      String?
  createdAt   DateTime @default(now())

  @@index([createdAt])
}

model Engagement {
  id          String   @id @default(cuid())
  type        String   // inquiry, favorite, share, contact, call
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  userId      String?
  createdAt   DateTime @default(now())

  @@index([propertyId])
  @@index([type])
  @@index([createdAt])
}

model Notification {
  id          String   @id @default(cuid())
  userId      String
  type        String   // inquiry, property_approved, membership_expiring, etc.
  title       String
  message     String
  link        String?
  metadata    String?  // JSON string
  read        Boolean  @default(false)
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

model PropertyInquiry {
  id          String   @id @default(cuid())
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  userId      String?
  name        String
  email       String
  phone       String?
  message     String
  status      String   @default("NEW") // NEW, CONTACTED, CONVERTED, CLOSED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([propertyId])
  @@index([status])
}
